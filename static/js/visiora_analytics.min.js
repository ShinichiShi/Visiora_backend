!function(){"use strict";const e={BATCH_SIZE:10,SEND_INTERVAL:5e3,SESSION_TIMEOUT:18e5,HEARTBEAT_INTERVAL:3e4,SCROLL_THRESHOLD:250,PERFORMANCE_SAMPLE_RATE:.1};let t=[],n=!1,r=Date.now(),i=Date.now(),o={25:!1,50:!1,75:!1,100:!1},a=!1;const s=document.currentScript||document.querySelector("script[data-tracking-id]");if(!s)return void console.warn("Visiora Analytics: Script tag not found");const l=s.getAttribute("data-tracking-id"),c=s.getAttribute("data-api-url"),u="true"===s.getAttribute("data-debug");function d(...e){u&&console.log("[Visiora Analytics]",...e)}function h(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function g(e,t){try{return t.getItem(e)}catch(n){return d("Storage access failed:",n),null}}function f(e,t,n){try{n.setItem(e,t)}catch(r){d("Storage write failed:",r)}}function m(){let e=g("visiora_visitor_id",localStorage);return e||(e=h(),f("visiora_visitor_id",e,localStorage),d("Created new visitor ID:",e)),e}function p(){const t=Date.now(),n=g("visiora_session",sessionStorage);if(n)try{const r=JSON.parse(n);if(t-r.lastActivity<e.SESSION_TIMEOUT)return r.lastActivity=t,f("visiora_session",JSON.stringify(r),sessionStorage),d("Continuing session:",r.sessionId),r.sessionId}catch(i){d("Invalid session data, creating new session")}const r=h(),o={sessionId:r,startTime:t,lastActivity:t};return f("visiora_session",JSON.stringify(o),sessionStorage),d("Created new session:",r),r}function v(){const e=navigator.userAgent;let t="desktop";/tablet|ipad|playbook|silk/i.test(e)?t="tablet":/mobile|iphone|ipod|android|blackberry|opera|mini|windows\sce|palm|smartphone|iemobile/i.test(e)&&(t="mobile");let n="unknown",r="";e.indexOf("Firefox")>-1?(n="Firefox",r=e.match(/Firefox\/([0-9]+)/)?.[1]||""):e.indexOf("Chrome")>-1?(n="Chrome",r=e.match(/Chrome\/([0-9]+)/)?.[1]||""):e.indexOf("Safari")>-1?(n="Safari",r=e.match(/Version\/([0-9]+)/)?.[1]||""):e.indexOf("Edge")>-1&&(n="Edge",r=e.match(/Edge\/([0-9]+)/)?.[1]||"");let i="unknown",o="";return e.indexOf("Windows NT")>-1?(i="Windows",o=e.match(/Windows NT ([0-9.]+)/)?.[1]||""):e.indexOf("Mac OS X")>-1?(i="macOS",o=e.match(/Mac OS X ([0-9_]+)/)?.[1]?.replace(/_/g,".")||""):e.indexOf("Linux")>-1?i="Linux":e.indexOf("Android")>-1?(i="Android",o=e.match(/Android ([0-9.]+)/)?.[1]||""):e.indexOf("iOS")>-1&&(i="iOS",o=e.match(/OS ([0-9_]+)/)?.[1]?.replace(/_/g,".")||""),{deviceType:t,browserName:n,browserVersion:r,osName:i,osVersion:o,userAgent:e,screenWidth:screen.width,screenHeight:screen.height,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}}function w(){const e=new URLSearchParams(window.location.search);return{utm_source:e.get("utm_source"),utm_medium:e.get("utm_medium"),utm_campaign:e.get("utm_campaign"),utm_term:e.get("utm_term"),utm_content:e.get("utm_content")}}function y(){const e=document.referrer;if(!e)return{referrer_url:null,referrer_domain:null,traffic_source:"direct"};try{const t=new URL(e),n=window.location.hostname,r=t.hostname;if(r===n)return{referrer_url:e,referrer_domain:r,traffic_source:"internal"};let i="referral";return r.includes("google.")?i="organic":!r.includes("facebook.")&&!r.includes("twitter.")&&!r.includes("linkedin.")&&!r.includes("instagram.")||(i="social"),{referrer_url:e,referrer_domain:r,traffic_source:i}}catch(t){return{referrer_url:e,referrer_domain:null,traffic_source:"referral"}}}function b(){return{tracking_id:l,visitor_id:m(),session_id:p(),timestamp:(new Date).toISOString(),page_url:window.location.href,page_title:document.title,page_path:window.location.pathname+window.location.search,...v(),...y(),...w()}}function S(n){t.push({...b(),...n}),d("Event queued:",n),t.length>=e.BATCH_SIZE&&T()}function T(){if(0===t.length)return;const e=[...t];t=[];const n=JSON.stringify({events:e});if(d("Sending events:",e),navigator.sendBeacon&&navigator.sendBeacon(c,new Blob([n],{type:"application/json"})))return void d("Events sent via sendBeacon");fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:n,keepalive:!0}).then((n=>{n.ok?d("Events sent via fetch"):(d("Failed to send events:",n.status),t.unshift(...e))})).catch((n=>{d("Network error sending events:",n),t.unshift(...e)}))}function I(){const e=Math.round((window.scrollY+window.innerHeight)/document.body.scrollHeight*100);for(const[t,n]of Object.entries(o))if(e>=parseInt(t)&&!n){o[t]=!0;S({event_type:"scroll_depth",event_name:"scroll_depth",event_category:"engagement",event_action:"scroll",event_label:`${t}%`,event_value:parseInt(t),properties:{scroll_percent:e}})}}function A(){if(a||Math.random()>e.PERFORMANCE_SAMPLE_RATE)return;if("complete"!==document.readyState)return void window.addEventListener("load",A,{once:!0});a=!0;try{const e=performance.getEntriesByType("navigation")[0];e&&S({event_type:"performance",event_name:"page_performance",event_category:"performance",properties:{dns_time:Math.round(e.domainLookupEnd-e.domainLookupStart),connect_time:Math.round(e.connectEnd-e.connectStart),response_time:Math.round(e.responseEnd-e.requestStart),dom_load_time:Math.round(e.domContentLoadedEventEnd-e.navigationStart),load_time:Math.round(e.loadEventEnd-e.navigationStart)}})}catch(t){d("Performance tracking failed:",t)}}function E(){document.addEventListener("click",(function(e){if("A"===e.target.tagName||"BUTTON"===e.target.tagName||e.target.closest("a, button")){const t=e.target.closest("a, button")||e.target;S({event_type:"click",event_name:"click",event_category:"interaction",event_action:"click",event_label:t.textContent?.trim()||t.getAttribute("aria-label")||t.tagName.toLowerCase(),properties:{element_tag:t.tagName.toLowerCase(),element_href:t.href||null,element_text:t.textContent?.trim().substring(0,100)||null}})}})),document.addEventListener("submit",(function(e){const t=e.target;S({event_type:"form_submit",event_name:"form_submit",event_category:"interaction",event_action:"submit",event_label:t.getAttribute("name")||t.getAttribute("id")||"unnamed_form",properties:{form_action:t.action||null,form_method:t.method||"get"}})}));let t;window.addEventListener("scroll",(function(){clearTimeout(t),t=setTimeout(I,100)})),document.addEventListener("visibilitychange",(function(){document.hidden&&T()})),window.addEventListener("beforeunload",(function(){T()})),setInterval((function(){const t=Date.now();t-i<e.SESSION_TIMEOUT&&S({event_type:"heartbeat",event_name:"heartbeat",event_category:"system",properties:{session_duration:t-r}})}),e.HEARTBEAT_INTERVAL),["mousedown","mousemove","keypress","scroll","touchstart"].forEach((e=>{document.addEventListener(e,(function(){i=Date.now()}),{passive:!0})}))}if(!l||!c)return void console.error("Visiora Analytics: Missing required data-tracking-id or data-api-url attributes");window.visiora={track:function(e,t={}){S({event_type:"custom",event_name:e,event_category:t.category||"custom",event_action:t.action||e,event_label:t.label||null,event_value:t.value||null,properties:t}),d("Custom event tracked:",e,t)},identify:function(e,t={}){S({event_type:"identify",event_name:"identify",event_category:"user",properties:{user_id:e,...t}}),d("User identified:",e,t)},flush:function(){T()},getIds:function(){return{visitorId:m(),sessionId:p()}}};function N(){n||(n=!0,d("Initializing Visiora Analytics",{trackingId:l,apiUrl:c}),S({event_type:"pageview",event_name:"pageview",event_category:"navigation"}),E(),A(),setInterval(T,e.SEND_INTERVAL),d("Visiora Analytics initialized"))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",N):N()}();